p(?X1,?E,?X2,?X3) :- r(?X1,?X2,?X3).

///QUERY:

Q() :- p('a',?X,'a',?U),p(?Y,?X,?V,?W),p(?Y,?Z,?V1,?W1),p('b',?Z,?U1,'b').

?- Q(). 