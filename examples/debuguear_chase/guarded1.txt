r4(?x, ?y, ?y) :- r2(?x), !r1(?x, ?y), r3(?y).
r7(?x, ?y, ?y) :- !r6(?y).


r1('a', 'b').
r2('a').
r3('b').

r1('c', 'd').
r2('c').
r3('d').




?- r4(?x, ?y, ?y).